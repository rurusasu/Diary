# WSL + docker + GPU (4)

そろそろ環境構築を終わらせたいので、一度いままでの内容をまとめようと思う。

## 参考

- [nvidia-docker コンテナ Deep Learning](https://blog.idcf.jp/entry/nvidia-docker#nvidia-docker-20)

- [nvidia docker って今どうなってるの？(19.11 版)](https://qiita.com/ksasaki/items/b20a785e1a0f610efa08)

- [nvidia docker って今どうなってるの？(20.09 版)](https://medium.com/nvidiajapan/nvidia-docker-%E3%81%A3%E3%81%A6%E4%BB%8A%E3%81%A9%E3%81%86%E3%81%AA%E3%81%A3%E3%81%A6%E3%82%8B%E3%81%AE-20-09-%E7%89%88-558fae883f44)


# 1. 環境構築

## 1.1. Ubuntu の初期設定

まずパッケージのアップデートを行う。

```
sudo apt update

sudo apt upgrade
```

## 1.2. WSL kernel update

```WSL2``` のカーネル ``` 4.19.121-microsoft ``` 以上で動作しているかを確認する。

```
uname -r
```

![umane](画像/0912/uname.png)

もし、``` 4.19.121-microsoft ``` より低い version で WSL が動作している場合は、


1. [CUDA Toolkit の web サイト](https://developer.nvidia.com/cuda-toolkit) にアクセスし、自分が欲しいディストリビューションに合わせたダウンロードファイルを選択する。

![CUDA-Toolkit-Download_1](画像/0912/CUDA-Toolkit-Download_1.png)

![CUDA-Toolkit-Download_2](画像/0912/CUDA-Toolkit-Download_2.png)

ここで、最後の行を

```
sudo apt-get -y install cuda-drivers
```

とすると、最新のドライバだけがきれいにインストールされる。

以下、CUDA Toolkitに記された通りにインストールする。

```
wget https://developer.download.nvidia.com/compute/cuda/repos/ubuntu2004/x86_64/cuda-ubuntu2004.pin

sudo mv cuda-ubuntu2004.pin /etc/apt/preferences.d/cuda-repository-pin-600

wget https://developer.download.nvidia.com/compute/cuda/11.0.3/local_installers/cuda-repo-ubuntu2004-11-0-local_11.0.3-450.51.06-1_amd64.deb

sudo dpkg -i cuda-repo-ubuntu2004-11-0-local_11.0.3-450.51.06-1_amd64.deb

sudo apt-key add /var/cuda-repo-ubuntu2004-11-0-local/7fa2af80.pub

sudo apt update

sudo apt -y install cuda-drivers
```

![CUDA-Toolkit-Download_3](画像/0912/CUDA-Toolkit-Download_3.png)

![CUDA-Toolkit-Download_3](画像/0912/CUDA-Toolkit-Download_4.png)

